<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interval Timer with Excel Import / Export</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
    background: #fff;
    margin: 0;
    display: flex;
    justify-content: center;
}
.container {
    width: 75vw;
    max-width: 900px;
    min-width: 320px;
    padding: 20px;
    margin: 20px auto;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
}
.stats {
    display: flex;
    justify-content: space-between;
    text-align: center;
}
.stat-label { font-size: 12px; color: #8e8e93; }
.stat-value { font-size: 22px; font-weight: 600; }

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 12px 0;
}
.header-buttons button { margin-left: 6px; }

.add-btn {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #007aff;
    color: #fff;
    font-size: 18px;
    border: none;
    cursor: pointer;
}

.interval {
    background: #f2f2f7;
    padding: 12px;
    border-radius: 12px;
    margin-bottom: 10px;
    cursor: grab;
}
.interval.current { background: #e5e5ea; }
.interval.dragging { opacity: 0.5; }

.row {
    display: flex;
    align-items: center;
    gap: 10px;
}
.color { width: 5px; height: 36px; border-radius: 3px; }
.red { background:#ff3b30; }
.orange { background:#ff9500; }
.blue { background:#007aff; }

.details {
    flex: 1;
    display: flex;
    justify-content: space-between;
}
.name-input, .time-input {
    border: none;
    background: transparent;
    font-size: 16px;
}
.time-input { width: 70px; text-align: right; }

.delete-btn {
    border: none;
    background: transparent;
    font-size: 18px;
    color: #ff3b30;
    cursor: pointer;
}

.progress-row {
    display: flex;
    gap: 10px;
    margin-top: 8px;
}
.progress-track {
    flex: 1;
    height: 6px;
    background: #d1d1d6;
    border-radius: 3px;
}
.progress-fill {
    height: 100%;
    background: #007aff;
}
.time-left { font-size: 12px; }

.controls {
    display: flex;
    justify-content: space-around;
    margin-top: 30px;
}
.play {
    width: 60px;
    height: 60px;
    background: #ff9500;
    color: white;
    border-radius: 50%;
    font-size: 30px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
}
.btn { font-size: 24px; cursor: pointer; }
</style>
</head>

<body>
<div class="container">

<div class="stats">
    <div><div class="stat-label">Elapsed</div><div id="elapsed">00:00</div></div>
    <div><div class="stat-label">Lap</div><div id="lapCount">1/1</div></div>
    <div><div class="stat-label">Left</div><div id="timeLeft">00:00</div></div>
</div>

<div class="header">
    <strong>Intervals</strong>
    <div class="header-buttons">
        <button class="add-btn" onclick="addInterval()">+</button>
        <button class="add-btn" onclick="downloadExcel()">‚¨á</button>
        <button class="add-btn" onclick="uploadExcel()">‚¨Ü</button>
        <input type="file" id="excelInput" hidden>
    </div>
</div>

<div id="intervalList"></div>

<div class="controls">
    <span class="btn" onclick="resetTimer()">‚Üª</span>
    <div class="play" id="playBtn" onclick="toggleTimer()">‚ñ∂</div>
    <span class="btn" onclick="skipInterval()">‚è≠</span>
</div>

</div>

<script>
const colors=["red","orange","blue"];
let intervals=[{name:"Interval 1",total:60,remaining:60,elapsed:0,color:"red"}];
let current=0,timer=null,running=false,totalElapsed=0,dragIndex=null;

const fmt=s=>`${String(Math.floor(s/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`;
const mmss=v=>{const[m,s]=v.split(":").map(Number);return m*60+(s||0);};

function beep(f=1000,d=150){
 const c=new AudioContext(),o=c.createOscillator(),g=c.createGain();
 o.connect(g);g.connect(c.destination);o.frequency.value=f;g.gain.value=.1;
 o.start();setTimeout(()=>{o.stop();c.close()},d);
}

function render(){
 intervalList.innerHTML="";
 intervals.forEach((i,idx)=>{
  const div=document.createElement("div");
  div.className="interval"+(idx===current?" current":"");
  div.draggable=true;
  div.ondragstart=()=>dragIndex=idx;
  div.ondrop=()=>reorder(idx);
  div.ondragover=e=>e.preventDefault();

  div.innerHTML=`
   <div class="row">
    <div class="color ${i.color}"></div>
    <div class="details">
     <input class="name-input" value="${i.name}" onblur="iName(${idx},this.value)">
     <input class="time-input" value="${fmt(i.total)}" onblur="iTime(${idx},this.value)">
    </div>
    <button class="delete-btn" onclick="del(${idx})">üóë</button>
   </div>
   <div class="progress-row">
    <div class="progress-track"><div class="progress-fill" style="width:${i.elapsed/i.total*100}%"></div></div>
    <div class="time-left">${fmt(i.remaining)}</div>
   </div>`;
  intervalList.appendChild(div);
 });
}

function iName(i,v){if(v.trim())intervals[i].name=v;}
function iTime(i,v){
 const s=mmss(v); if(s>0){intervals[i].total=s;intervals[i].remaining=s;intervals[i].elapsed=0;}
 render();update();
}

function reorder(i){
 if(i===dragIndex)return;
 intervals.splice(i,0,intervals.splice(dragIndex,1)[0]);
 render();update();
}

function addInterval(){
 intervals.push({name:`Interval ${intervals.length+1}`,total:60,remaining:60,elapsed:0,color:colors[intervals.length%colors.length]});
 render();update();
}

function del(i){
 if(intervals.length===1)return;
 intervals.splice(i,1);
 current=Math.min(current,intervals.length-1);
 render();update();
}

function tick(){
 const c=intervals[current];
 if(c.remaining<=3&&c.remaining>0)beep();
 c.remaining--;c.elapsed++;totalElapsed++;
 if(c.remaining<=0){
  beep(1400,300);
  if(current<intervals.length-1)current++;
  else return stop();
 }
 render();update();
}

function start(){timer=setInterval(tick,1000);running=true;playBtn.textContent="‚è∏";}
function stop(){clearInterval(timer);running=false;playBtn.textContent="‚ñ∂";}
function toggleTimer(){running?stop():start();}
function resetTimer(){stop();current=0;totalElapsed=0;intervals.forEach(i=>{i.remaining=i.total;i.elapsed=0});render();update();}
function skipInterval(){intervals[current].remaining=1;}

function update(){
 elapsed.textContent=fmt(totalElapsed);
 lapCount.textContent=`${current+1}/${intervals.length}`;
 timeLeft.textContent=fmt(intervals.slice(current).reduce((s,i)=>s+i.remaining,0));
}

/* ===== Excel (NO COLOR COLUMN) ===== */
function downloadExcel(){
 const data=intervals.map(i=>({
  Name:i.name,
  Minutes:Math.floor(i.total/60),
  Seconds:i.total%60
 }));
 const ws=XLSX.utils.json_to_sheet(data);
 const wb=XLSX.utils.book_new();
 XLSX.utils.book_append_sheet(wb,ws,"Intervals");
 XLSX.writeFile(wb,"intervals.xlsx");
}

function uploadExcel(){excelInput.click();}
excelInput.onchange=e=>{
 const r=new FileReader();
 r.onload=x=>{
  const wb=XLSX.read(new Uint8Array(x.target.result),{type:"array"});
  const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
  intervals=rows.map((r,i)=>{
   const t=(+r.Minutes||0)*60+(+r.Seconds||0)||60;
   return {name:r.Name||`Interval ${i+1}`,total:t,remaining:t,elapsed:0,color:colors[i%colors.length]};
  });
  resetTimer();
 };
 r.readAsArrayBuffer(e.target.files[0]);
};

render();update();
</script>
</body>
</html>
